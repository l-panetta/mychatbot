<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Mon Chatbot</title>
  <style>
    body{font-family:Arial;max-width:800px;margin:20px auto;padding:10px}
    #chat{border:1px solid #ddd;padding:10px;height:400px;overflow:auto;margin-bottom:10px}
    .msg{margin:6px 0}
    .me{font-weight:600}
    .bot{color:#064}
  </style>
</head>
<body>
  <h2>Chatbot (prototype)</h2>
  <div id="chat"></div>
  <input id="msg" placeholder="Écris ta question..." style="width:80%"/>
  <button id="send">Envoyer</button>

  <script>
    const chatEl = document.getElementById('chat');
    function append(who, text){
      const d = document.createElement('div');
      d.className = 'msg';
      d.innerHTML = `<span class="${who==='me'?'me':'bot'}">${who=== 'me' ? 'Tu' : 'Bot'}:</span> ${text}`;
      chatEl.appendChild(d);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    async function send(){
      const input = document.getElementById('msg');
      const m = input.value.trim();
      if(!m) return;
      append('me', m);
      input.value = '';
      append('bot', '…en train de réfléchir…');

      try{
        const res = await fetch('/api/chat', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ message: m })
        });
        const j = await res.json();
        chatEl.lastChild.remove();
        append('bot', j.reply || JSON.stringify(j));
      }catch(e){
        chatEl.lastChild.remove();
        append('bot', 'Erreur : ' + e.message);
      }
    }

    document.getElementById('send').addEventListener('click', send);
    document.getElementById('msg').addEventListener('keydown', e => { if(e.key==='Enter') send(); });
  </script>
</body>
</html>
